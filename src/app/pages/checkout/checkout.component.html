    <mat-vertical-stepper #horizontalStepper linear="true" class="mat-elevation-z2">
  
      <mat-step [stepControl]="billingForm || billingForm2" label="Billing address">
        <div *ngIf="!logged">
          <form [formGroup]="billingForm" (ngSubmit)="onBllSubmit(billingForm.value)">     
            <div fxLayout="row wrap">
              <div fxFlex.sm="50" fxFlex.gt-sm="33.3" class="px-1">
                <mat-form-field class="w-100">
                    <input matInput placeholder="First name" formControlName="firstName" required>
                    <mat-error *ngIf="billingForm.controls.firstName.errors?.required">First name is required</mat-error>
                </mat-form-field>
              </div>
              <div fxFlex.sm="50" fxFlex.gt-sm="33.3" class="px-1">
                <mat-form-field class="w-100">
                    <input matInput placeholder="Last name" formControlName="lastName" required>
                    <mat-error *ngIf="billingForm.controls.lastName.errors?.required">Last name is required</mat-error>
                </mat-form-field>
              </div>
              <div fxFlex="100" fxFlex.gt-sm="33.3" class="px-1" fxShow="false" fxShow.gt-sm>
                <mat-form-field class="w-100">
                    <input matInput placeholder="Middle Name/Initial" formControlName="middleName">
                </mat-form-field>
              </div>
              <div fxFlex.sm="50" fxFlex.gt-sm="33.3" class="px-1">
                <mat-form-field class="w-100">
                    <input matInput placeholder="Company" formControlName="company">
                </mat-form-field>
              </div>
              <div fxFlex.sm="50" fxFlex.gt-sm="33.3" class="px-1">
                <mat-form-field class="w-100">
                    <input matInput placeholder="Email" formControlName="email" required>
                    <mat-error *ngIf="billingForm.controls.email.errors?.required">Email is required</mat-error>
                </mat-form-field>
              </div>
              <div fxFlex.sm="50" fxFlex.gt-sm="33.3" class="px-1">
                <mat-form-field class="w-100">
                    <input matInput placeholder="Phone" formControlName="phone" required>
                    <mat-error *ngIf="billingForm.controls.phone.errors?.required">Phone is required</mat-error>
                </mat-form-field>
              </div>
              <div fxFlex.sm="50" fxFlex.gt-sm="33.3" class="px-1">
                <mat-form-field class="w-100">
                  <mat-select placeholder="Country" formControlName="country" required>
                    <mat-option *ngFor="let country of countries" [value]="country">
                        {{country.name}}
                    </mat-option>
                  </mat-select>
                  <mat-error *ngIf="billingForm.controls.country.errors?.required">Country is required</mat-error>
                </mat-form-field>
              </div>
              <div fxFlex.sm="50" fxFlex.gt-sm="33.3" class="px-1">
                  <mat-form-field class="w-100">
                    <mat-select placeholder="State/Province" formControlName="state" required>
                      <mat-option *ngFor="let state of states" [value]="state.name">
                          {{state.name}}
                      </mat-option>
                    </mat-select>
                    <mat-error *ngIf="billingForm.controls.state.errors?.required">State is required</mat-error>
                  </mat-form-field>
                </div>
              <div fxFlex.sm="50" fxFlex.gt-sm="33.3" class="px-1">
                <mat-form-field class="w-100">
                    <input matInput placeholder="City" formControlName="city" required>
                    <mat-error *ngIf="billingForm.controls.city.errors?.required">City is required</mat-error>
                </mat-form-field>
              </div>
              <!--<div fxFlex="100" fxFlex.gt-sm="25" class="px-1">
                <mat-form-field class="w-100">
                    <input matInput placeholder="State/Province" formControlName="state">
                </mat-form-field>
              </div>
              <div fxFlex="100" fxFlex.gt-sm="25" class="px-1">
                <mat-form-field class="w-100">
                    <input matInput placeholder="Zip/Postal Code" formControlName="zip" required>
                    <mat-error *ngIf="billingForm.controls.zip.errors?.required">Zip/Postal Code is required</mat-error>
                </mat-form-field>
              </div> -->
              <div fxFlex="100" class="px-1">
                <mat-form-field class="w-100">
                    <input matInput placeholder="Address (street, apartment, suite, unit etc.)" formControlName="address" required>
                    <mat-error *ngIf="billingForm.controls.address.errors?.required">Address is required</mat-error>
                </mat-form-field>
              </div>
            </div>
            <div fxLayout="row" fxLayoutAlign="center center" class="mt-2 p-1"> 
              <button mat-mini-fab matStepperNext color="primary" matTooltip="Next" matTooltipPosition="after"><mat-icon>keyboard_arrow_down</mat-icon></button>
            </div>
          </form>
        </div>
        <div *ngIf="logged">
          <div *ngIf="showForm">
              <h3>Enter Address <span>or</span></h3><a mat-raised-button color="primary" (click)="BshowForm(false)">Select Address</a>
              <br />
              <form [formGroup]="billingForm" (ngSubmit)="onBllSubmit(billingForm.value)">     
                <div fxLayout="row wrap">
                  <div fxFlex="100" fxFlex.gt-sm="33.3" class="px-1">
                    <mat-form-field class="w-100">
                        <input matInput placeholder="First name" formControlName="firstName" required>
                        <mat-error *ngIf="billingForm.controls.firstName.errors?.required">First name is required</mat-error>
                    </mat-form-field>
                  </div>
                  <div fxFlex="100" fxFlex.gt-sm="33.3" class="px-1">
                    <mat-form-field class="w-100">
                        <input matInput placeholder="Last name" formControlName="lastName" required>
                        <mat-error *ngIf="billingForm.controls.lastName.errors?.required">Last name is required</mat-error>
                    </mat-form-field>
                  </div>
                  <!-- <div fxFlex="100" fxFlex.gt-sm="33.3" class="px-1">
                    <mat-form-field class="w-100">
                        <input matInput placeholder="Middle Name/Initial" formControlName="middleName">
                    </mat-form-field>
                  </div> -->
                  <div fxFlex="100" fxFlex.gt-sm="33.3" class="px-1">
                    <mat-form-field class="w-100">
                        <input matInput placeholder="Company" formControlName="company">
                    </mat-form-field>
                  </div>
                  <div fxFlex="100" fxFlex.gt-sm="33.3" class="px-1">
                    <mat-form-field class="w-100">
                        <input matInput placeholder="Email" formControlName="email" required (change)="onlogin(billingForm.value.email)">
                        <mat-error *ngIf="billingForm.controls.email.errors?.required">Email is required</mat-error>
                    </mat-form-field>
                  </div>
                  <div fxFlex="100" fxFlex.gt-sm="33.3" class="px-1">
                    <mat-form-field class="w-100">
                        <input matInput placeholder="Phone" formControlName="phone" required>
                        <mat-error *ngIf="billingForm.controls.phone.errors?.required">Phone is required</mat-error>
                    </mat-form-field>
                  </div>
                  <div fxFlex="100" fxFlex.gt-sm="25" class="px-1">
                    <mat-form-field class="w-100">
                      <mat-select placeholder="Country" formControlName="country" required>
                        <mat-option *ngFor="let country of countries" [value]="country">
                            {{country.name}}
                        </mat-option>
                      </mat-select>
                      <mat-error *ngIf="billingForm.controls.country.errors?.required">Country is required</mat-error>
                    </mat-form-field>
                  </div>
                  <div fxFlex="100" fxFlex.gt-sm="25" class="px-1">
                      <mat-form-field class="w-100">
                        <mat-select placeholder="State/Province" formControlName="state" required>
                          <mat-option *ngFor="let state of states" [value]="state.name">
                              {{state.name}}
                          </mat-option>
                        </mat-select>
                        <mat-error *ngIf="billingForm.controls.state.errors?.required">State is required</mat-error>
                      </mat-form-field>
                    </div>
                  <div fxFlex="100" fxFlex.gt-sm="25" class="px-1">
                    <mat-form-field class="w-100">
                        <input matInput placeholder="City" formControlName="city" required>
                        <mat-error *ngIf="billingForm.controls.city.errors?.required">City is required</mat-error>
                    </mat-form-field>
                  </div>
                  <!-- <div fxFlex="100" fxFlex.gt-sm="25" class="px-1">
                    <mat-form-field class="w-100">
                        <input matInput placeholder="State/Province" formControlName="state">
                    </mat-form-field>
                  </div>
                  <div fxFlex="100" fxFlex.gt-sm="25" class="px-1">
                    <mat-form-field class="w-100">
                        <input matInput placeholder="Zip/Postal Code" formControlName="zip" required>
                        <mat-error *ngIf="billingForm.controls.zip.errors?.required">Zip/Postal Code is required</mat-error>
                    </mat-form-field>
                  </div> -->
                  <div fxFlex="100" class="px-1">
                    <mat-form-field class="w-100">
                        <input matInput placeholder="Address (street, apartment, suite, unit etc.)" formControlName="address" required>
                        <mat-error *ngIf="billingForm.controls.address.errors?.required">Address is required</mat-error>
                    </mat-form-field>
                  </div>
                </div>
                <div fxLayout="row" fxLayoutAlign="center center" class="mt-2 p-1"> 
                  <button mat-mini-fab matStepperNext color="primary" matTooltip="Next" matTooltipPosition="after"><mat-icon>keyboard_arrow_down</mat-icon></button>
                </div>
              </form>
          </div>
          <div *ngIf="!showForm">
            <h3>Select one of the follow Addresses or </h3>
            <a mat-raised-button color="primary" (click)="BshowForm(true)">Enter New Address</a>
            <form [formGroup]="billingForm2" (ngSubmit)="onBllSubmit2(billingForm2.value)">
                <mat-radio-group formControlName="billingMethod" fxLayout="column" fxLayoutAlign="center" required name="methods">
                    <mat-radio-button *ngFor="let method of billingAddress" color="primary" [value]="method" class="mt-1"><b>{{method.street}}</b></mat-radio-button>
                  </mat-radio-group>  
                <div fxLayout="row" fxLayoutAlign="center center" class="mt-2 p-1"> 
                  <button mat-mini-fab matStepperNext color="primary" matTooltip="Next" matTooltipPosition="after"><mat-icon>keyboard_arrow_down</mat-icon></button>
                </div>
            </form>
          </div>
        </div>
      </mat-step>
      <mat-step [stepControl]="deliveryForm" label="Delivery method">
          <div *ngIf="loading" class="swiper-lazy-preloader"></div>
          <form [formGroup]="deliveryForm"  (ngSubmit)="onDevSubmit(deliveryForm.value)" class="p-2">
            <mat-radio-group formControlName="deliveryMethod" fxLayout="column" fxLayoutAlign="center" required name="methods">
                <mat-radio-button *ngFor="let method of s_method" color="primary" [value]="method" class="mt-1"><b>{{method.carrier_title}}</b> - &#8358;{{method.amount}}</mat-radio-button>              
            </mat-radio-group> 
            <div fxLayout="row" fxLayoutAlign="center center" class="mt-2 p-1"> 
              <button mat-mini-fab matStepperPrevious color="primary" matTooltip="Back" matTooltipPosition="before" class="mr-1"><mat-icon>keyboard_arrow_up</mat-icon></button>
              <button mat-mini-fab matStepperNext color="primary" matTooltip="Next" matTooltipPosition="after"><mat-icon>keyboard_arrow_down</mat-icon></button>
            </div>
          </form>
      </mat-step>
      <mat-step [stepControl]="paymentForm" label="Payment method">
            <form [formGroup]="paymentForm" (ngSubmit)="onPaySub(paymentForm.value)">
              <mat-radio-group formControlName="paymentMethod" fxLayout="column" fxLayoutAlign="center" required name="methods">
                <mat-radio-button *ngFor="let method of pay_method" color="primary" [value]="method" class="mt-1"><b>{{method.title}}</b></mat-radio-button>        
              </mat-radio-group>            
              <div fxLayout="row" fxLayoutAlign="center center" class="mt-2 p-1"> 
                <button mat-mini-fab matStepperPrevious color="primary" matTooltip="Back" matTooltipPosition="before" class="mr-1"><mat-icon>keyboard_arrow_up</mat-icon></button>
                <button mat-mini-fab matStepperNext color="primary" matTooltip="Next" matTooltipPosition="after"><mat-icon>keyboard_arrow_down</mat-icon></button>       
              </div>
            </form>
      </mat-step>
      <mat-step label="Review Order">    
        <div fxLayout="row wrap">
          <div fxFlex="100" class="p-1">
            <h3 class="text-muted">Shopping Cart</h3>
            <div class="divider"></div>
            <div class="mat-table review-order-table">
              <div class="mat-header-row">
                <div class="mat-header-cell">Product</div>
                <div class="mat-header-cell">Name</div>
                <div class="mat-header-cell">Unit Price</div>      
                <div class="mat-header-cell">Quantity</div>
                <div class="mat-header-cell">Total</div>
              </div>
              <div *ngFor="let product of appService.cartitems" class="mat-row">
                  <div class="mat-cell"><img [src]="base_url_mage+product.image"></div>
                  <div class="mat-cell">{{product?.name}}</div>
                  <div class="mat-cell">₦{{product?.price | number : '1.2-2'}}</div>      
                  <div class="mat-cell text-muted"> {{product?.qty}} </div>
                  <div class="mat-cell">₦{{ (product?.price*product?.qty) | number : '1.2-2'}}</div>
                </div>
            </div>
          </div> 
        </div>
        <div fxLayout="row wrap" *ngIf="address">
          <div fxFlex="100" class="p-1">
            <h3 class="text-muted mt-2">Billing information</h3>
            <div class="divider"></div>
          </div>
          <div fxLayout="column" fxFlex="100" fxFlex.gt-sm="25" class="p-1">
            <p class="text-muted">Name:</p>
            <p>{{address.firstname}} {{address.lastname}}</p>
          </div>
          <div fxLayout="column" fxFlex="100" fxFlex.gt-sm="25" class="p-1">
            <p class="text-muted">Email:</p>
            <p>{{address.email}}</p>
          </div>
          <div fxLayout="column" fxFlex="100" fxFlex.gt-sm="25" class="p-1">
            <p class="text-muted">Phone:</p>
            <p>{{address.phone || address.telephone}}</p>
          </div>
          <div fxLayout="column" fxFlex="100" fxFlex.gt-sm="25" class="p-1">
            <p class="text-muted">Country:</p>
            <p>{{address.country_id}}</p>
          </div>
          <div fxLayout="column" fxFlex="100" fxFlex.gt-sm="25" class="p-1">
            <p class="text-muted">City:</p>
            <p>{{address.city}}</p>
          </div>
          <div fxLayout="column" fxFlex="100" fxFlex.gt-sm="25" class="p-1">
            <p class="text-muted">State:</p>
            <p>{{address.region}}</p>
          </div>
          <div fxLayout="column" fxFlex="100" fxFlex.gt-sm="25" class="p-1">
            <p class="text-muted">Zip/PostalCode:</p>
            <p>{{address.postcode}}</p>
          </div>
          <div fxLayout="column" fxFlex="100" fxFlex.gt-sm="25" class="p-1">
            <p class="text-muted">Address:</p>
            <p>{{address.street}}</p>
          </div>
        </div>
        <div fxLayout="row">
          <div fxFlex="100" class="p-1">
            <h3 class="text-muted mt-2">Delivery information</h3>
            <div class="divider"></div>
            <p class="py-1">{{deliveryForm.controls.deliveryMethod.value.carrier_title}} <span class="text-muted">{{deliveryForm.controls.deliveryMethod.value.amount}}</span></p>
          </div>
        </div>
        <div fxLayout="row">
          <div fxFlex="100" class="p-1">
            <h3 class="text-muted mt-2">Payment information</h3>
            <div class="divider"></div>
            <p class="py-1"><span class="text-muted mr-1">PayMent Method:</span><span>{{p_method}}</span></p>
          </div>
        </div>
        <div fxLayout="row" fxLayoutAlign="center center" class="p-1"> 
            <h2><span class="text-muted mr-1">Total Price:</span><span>₦{{(grandTotal) | number : '1.2-2'}}</span></h2>    
        </div>
        <div fxLayout="row" fxLayoutAlign="center center" class="mt-2 p-1"> 
          <div *ngIf="p_method == 'pstk_paystack'">
            <button
              angular4-paystack
              [key]="paystack_key"
              [email]="address.email"
              [amount]="refAmount"
              [ref]="ref"
              (close)="paymentCancel()"
              (callback)='PaymentComplete($event)' mat-raised-button matStepperNext color="primary" (click)="startL()">Pay With Paystack
            </button>
          </div>
          <div *ngIf="p_method !== 'pstk_paystack'">
            <button mat-mini-fab matStepperPrevious color="primary" matTooltip="Back" matTooltipPosition="before" class="mr-1"><mat-icon>keyboard_arrow_up</mat-icon></button>
            <button mat-raised-button matStepperNext color="primary" (click)="createOrder()">Place order now</button>       
          </div>
        </div>     
      </mat-step>
      <mat-step label="Confirmation">
          <div *ngIf="!loading && !pay">
              Waiting for Payment >>>>>>>
          </div>
            <div *ngIf="pay">
              <div fxLayout="column" fxLayoutAlign="center center" class="p-2 text-center"> 
                <button mat-fab color="primary"><mat-icon>check</mat-icon></button>
                <h2 class="py-2">Congratulation! Your order has been processed</h2>    
                <p class="text-muted">Thank you for Purchasing your invoice has been sent to your mail.</p>
                <img src="assets/images/paystack.png" style="width:30em;"/>        
              </div>
              <div fxLayout="row" fxLayoutAlign="center center" class="mt-2 p-1"> 
                <a [routerLink]="['/']" mat-raised-button color="primary">Return to Shop</a>       
              </div>
            </div>
            <div *ngIf="bank">
              <div fxLayout="column" fxLayoutAlign="center center" class="p-2 text-center"> 
                <button mat-fab color="primary"><mat-icon>check</mat-icon></button>
                <h2 class="py-2">Congratulation! Your order is been processed</h2>
                <div class="text-muted">You are Required to pay the Total of<h3><strong>₦{{grandTotal }}</strong></h3></div>
                <p>Bank: </p>
                <p>Account Name: </p>
                <p>Account Number: </p>
              </div>
              <div fxLayout="row" fxLayoutAlign="center center" class="mt-2 p-1"> 
                <a [routerLink]="['/']" mat-raised-button color="primary">Return to Shop</a>       
              </div>
            </div>
        </mat-step>
    </mat-vertical-stepper>